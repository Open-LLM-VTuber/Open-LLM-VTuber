version: "3.9"

services:
  vtuber:
    image: open-llm-vtuber:latest
    build:
      context: .              # Build context: current directory containing Dockerfile
      dockerfile: Dockerfile
      args:
        INSTALL_BARK: "true"  # Enable optional installation of Bark (speech synthesis model)
    container_name: open-llm-vtuber
    ports:
      - "12393:12393"         # Map container port 12393 to host port 12393 (API or UI)
    volumes:
      - ./:/app               # Mount current directory into /app inside container (for local dev)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]  # Request access to all available NVIDIA GPUs
    environment:
      - NVIDIA_VISIBLE_DEVICES=all  # Ensure container sees all GPUs
      - UV_LINK_MODE=copy           # Prevent symlinks, use file copy for uv (safer in mounted volumes)
    command: ["uv", "run", "run_server.py"]  # Default command to launch the app
