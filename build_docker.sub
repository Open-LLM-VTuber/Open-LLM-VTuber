#!/bin/bash
#SBATCH --job-name=build-docker
#SBATCH --partition=debug          # 可选分区名，根据实际情况修改
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=32G
#SBATCH --time=04:00:00
#SBATCH --output=logs/build_output.log
#SBATCH --error=logs/build_error.log

# === 初始化 ===
set -euo pipefail
trap 'echo "❌ 任务失败: 行号 $LINENO, 状态码 $?"' ERR

echo "🚀 开始构建 Docker 镜像..."
echo "📅 时间: $(date)"
echo "📍 节点: $(hostname)"
echo "📂 当前目录: $(pwd)"

# === 镜像名称 ===
IMAGE_NAME="open-llm-vtuber:latest"

# === 构建镜像 ===
docker build -t $IMAGE_NAME .

# === 保存镜像为 .tar 以便下载或传输 ===
docker save $IMAGE_NAME -o open-llm-vtuber.tar

echo "✅ Docker 镜像已构建并保存为 open-llm-vtuber.tar"