#!/bin/bash
#SBATCH --job-name=build-docker
#SBATCH --partition=debug          # å¯é€‰åˆ†åŒºåï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=32G
#SBATCH --time=04:00:00
#SBATCH --output=logs/build_output.log
#SBATCH --error=logs/build_error.log

# === åˆå§‹åŒ– ===
set -euo pipefail
trap 'echo "âŒ ä»»åŠ¡å¤±è´¥: è¡Œå· $LINENO, çŠ¶æ€ç  $?"' ERR

echo "ğŸš€ å¼€å§‹æ„å»º Docker é•œåƒ..."
echo "ğŸ“… æ—¶é—´: $(date)"
echo "ğŸ“ èŠ‚ç‚¹: $(hostname)"
echo "ğŸ“‚ å½“å‰ç›®å½•: $(pwd)"

# === é•œåƒåç§° ===
IMAGE_NAME="open-llm-vtuber:latest"

# === æ„å»ºé•œåƒ ===
docker build -t $IMAGE_NAME .

# === ä¿å­˜é•œåƒä¸º .tar ä»¥ä¾¿ä¸‹è½½æˆ–ä¼ è¾“ ===
docker save $IMAGE_NAME -o open-llm-vtuber.tar

echo "âœ… Docker é•œåƒå·²æ„å»ºå¹¶ä¿å­˜ä¸º open-llm-vtuber.tar"